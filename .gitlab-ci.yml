backend_docker_build:
    stage: build
    image: docker:19.03.1
    services:
      - docker:dind
    variables:
        DOCKER_DRIVER: overlay
    before_script:
        - "cd backend"
        - sudo apt-get install build-essential
    script: 
        - "make build-nc"
    only:
        changes:
          - backend/**/*
backend_docker_publish:
    stage: publish
    image: docker:19.03.1
    services:
      - docker:dind
    variables:
        DOCKER_DRIVER: overlay
    before_script:
        - "cd backend"
        - sudo apt-get install build-essential
        - "echo $GCLOUD_SERVICE_ACCOUNT | base64 -d > ${HOME}/gcloud-service-key.json"
        - "docker login -u _json_key --password-stdin https://eu.gcr.io < ${HOME}/gcloud-service-key.json"
    script: 
        - echo $TEST
        - "make publish"
    only:
        changes:
          - backend/**/*
